<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div>
      <h1>E-Palancas</h1>
    </div>

    <br>

    <div>
      <button type="button" onclick="handleClassPick('MIPA1')">MIPA 1</button>
      <button type="button" onclick="handleClassPick('MIPA2')">MIPA 2</button>
      <button type="button" onclick="handleClassPick('MIPA3')">MIPA 3</button>
      <button type="button" onclick="handleClassPick('IPS1')">IPS 1</button>
      <button type="button" onclick="handleClassPick('IPS2')">IPS 2</button>
      <button type="button" onclick="handleClassPick('IPB')">IPB</button>
      <button type="button" onclick="handleClassPick('missingPerson')">Missing Person</button>
    </div>

    <div id="student-container">
      <? renderStudents("MIPA1") ?>

      <? for(let i = 0; i < studArr.length; i++) { ?>
      <div class="student">
        <h2><?!= studArr[i].id ?></h2>
        <h2><?!= studArr[i].name ?></h2>
        <button class="dropdown-btn">Dropdown</button>
        <form class="student-form">
          <label for="senderName">Nama Pengirim:</label>
          <input type="text" id="senderName" name="fname" placeholder="kosongkan bila ingin menulis secara anonim">
          <br><br>

          <label for="writtingsText">Isi Palancas:</label>
          <textarea id="writtingsText" name="subject" placeholder="Isi Palancas.." style="height:200px"></textarea>

          <br><br>
          <button type="button" onclick="handleSubmit()">Kirim</button>
          <label id="resp">test</label>

          <br><br>
          <h2>Test upload file ke image database</h2>

          <br><br>

          <input id="file" type="file" onchange="saveFile(this)">
        <button type="button" id="sendFile" >Kirim</button>

        </form>
      </div>
      <? }; ?>
    </div>

    <script>
      function handleClassPick(studClass) {
        let studArr = [];
        let parent = getElementById("student-container")
        parent.innerHTML = ""
        /*
        while (parent.firstChild) {
          parent.removeChild(parent.firstChild);
        };*/
        let test = studClass;

        google.script.run.renderStudents(studClass)
      }
    </script>


    <script>
    /*
      function handleDropdown() {
        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;


      }*/

    var dropdown = document.getElementsByClassName("dropdown-btn");
    var i;

    for (i = 0; i < dropdown.length; i++) {
      dropdown[i].addEventListener("click", function() {
      this.classList.toggle("active");
      /*var j:
      for (j = 0; j < dropdown.length; j++) {
        let dropdown2 = document.getElementsByClassName("dropdown-btn");
        dropdown2[j].nextElementSibling.style.display = "none";
      }*/
      var dropdownContent = this.nextElementSibling;
      if (dropdownContent.style.display === "block") {
      dropdownContent.style.display = "none";
      } else {
      dropdownContent.style.display = "block";
      }
      });
    }

    </script>


    <script>
      function handleSubmit(destinationUrl) {
        let message = document.getElementById("writtingsText").value
        let sender = document.getElementById("senderName").value

        if (sender == "") {
          sender = "anonim"
        }
        
        document.getElementById("resp").innerHTML = "Palancas Berhasil Dikirim";
        alert("Palancas Berhasil Dikirim")
        google.script.run.appendSlide(message, sender)//, destinationUrl);
      }

      function saveFile(f) {
      const file = f.files[0];
      const fr = new FileReader();
      fr.onload = function(e) {
        const obj = {
          filename: file.name,
          mimeType: file.type,
          bytes: [...new Int8Array(e.target.result)]
        };
        document.getElementById("sendFile").addEventListener("click", google.script.run.withSuccessHandler(e => console.log(e)).saveFile(obj));
        
        };
      fr.readAsArrayBuffer(file);
      }
    
  </script>
  </body>
</html>
